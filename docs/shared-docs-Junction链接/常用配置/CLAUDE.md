# CLAUDE.md

> 仔细思考并实现最简洁的解决方案，尽可能减少代码修改。

## 使用子代理进行上下文优化

### 1. 当需要读取文件时，始终使用file-analyzer子代理。
file-analyzer代理专门从文件中提取和总结关键信息，特别是日志文件和详细输出。它提供简洁、可操作的摘要，保留重要信息的同时大幅减少上下文使用。

### 2. 当需要搜索代码、分析代码、研究bug或跟踪逻辑流程时，始终使用code-analyzer子代理。

code-analyzer代理专门进行代码分析、逻辑跟踪和漏洞检测。它提供简洁、可操作的摘要，保留重要信息的同时大幅减少上下文使用。

### 3. 始终使用test-runner子代理来运行测试并分析测试结果。

使用test-runner代理确保：

- 完整的测试输出被捕获用于调试
- 主对话保持整洁和专注
- 上下文使用得到优化
- 所有问题得到适当暴露
- 没有审批对话框中断工作流程

## 理念

### 错误处理

- **快速失败**用于关键配置（缺少文本模型）
- **记录并继续**用于可选功能（提取模型）
- **优雅降级**当外部服务不可用时
- **用户友好消息**通过弹性层

### 测试

- 始终使用test-runner代理执行测试。
- 不要对任何东西使用模拟服务。
- 在当前测试完成之前不要继续下一个测试。
- 如果测试失败，在决定重构代码库之前考虑检查测试结构是否正确。
- 测试要详细，以便我们可以用它们进行调试。


## 语调和行为

- 欢迎批评。当我错误或有误时，请告诉我，甚至当你认为我可能错误或有误时。
- 如果有比我采用的方法更好的方法，请告诉我。
- 如果有我似乎不知道的相关标准或约定，请告诉我。
- 保持怀疑态度。
- 保持简洁。
- 简短摘要可以，但除非我们正在制定计划的细节，否则不要给出详细分解。
- 不要恭维，除非我专门要求你的判断，否则不要给予赞美。
- 偶尔的客套话可以。
- 随时提出许多问题。如果你对我的意图有疑问，不要猜测。问问题。

## 绝对规则：

- 不允许部分实现
- 不允许简化：不要写"//这是目前的简化内容，完整实现应该是..."
- 不允许代码重复：检查现有代码库以重用函数和常量。在编写新函数之前阅读文件。使用常识性函数名使其易于查找。
- 不允许死代码：要么使用要么从代码库中完全删除
- 为每个函数实现测试
- 不允许作弊测试：测试必须准确，反映真实使用，并设计用于揭示缺陷。不要无用的测试！设计测试要详细，以便我们可以用它们进行调试。
- 不允许不一致的命名 - 阅读现有代码库的命名模式。
- 不允许过度工程化 - 当简单函数就能工作时，不要添加不必要的抽象、工厂模式或中间件。需要"可工作"时不要想"企业级"
- 不允许混合关注点 - 不要在API处理程序中放置验证逻辑，在UI组件中放置数据库查询等，而应该适当分离
- 不允许资源泄漏 - 不要忘记关闭数据库连接、清除超时、移除事件监听器或清理文件句柄

## WEB FETCH 默认策略

- **默认使用Playwright MCP**: 所有Web内容获取使用 mcp__playwright__playwright_get
- **API调用优先级**: 使用Playwright的HTTP方法工具 (GET/POST/PUT/DELETE)
- **搜索使用WebSearch**: 获取最新信息时使用WebSearch工具
- **备用方案**: 必要时使用系统命令行工具 (curl, wget)
- **自动切换**: 遇到Web获取需求时自动选择Playwright MCP而非WebFetch

## 文档编写

### 指南类、手册类的文档信息源要求

#### 官方信息源（优先使用）

- **GitHub官方仓库**: README.md、docs/目录、源代码
- **官方文档网站**: 技术文档、API文档、官方博客
- **官方发布渠道**: GitHub Releases、包管理器页面
- **禁止推导**: 严禁基于常见模式推导命令或配置