# SilverQuant 配置参数说明

## 凭证配置credentials.py

### QMT账户配置

#### QMT_ACCOUNT_ID
- 类型: 字符串
- 说明: QMT账户ID
- 获取方式: 咨询券商客户经理
- 示例: '55009728'
- 必需: 实盘必需

#### QMT_CLIENT_PATH
- 类型: 字符串(原始字符串)
- 说明: QMT客户端userdata_mini目录路径
- 查找方法: 启动QMT后在安装目录查找
- 示例: r'C:\国金证券QMT交易端\userdata_mini'
- 必需: 实盘必需
- 注意: 使用r前缀避免转义

### 通知配置

#### DING_SECRET
- 类型: 字符串
- 说明: 钉钉机器人加签密钥
- 获取方式: 钉钉群机器人设置-安全设置
- 示例: 'SECa0ab7f3ba9742c0...'
- 必需: 可选
- 用途: 交易通知推送

#### DING_TOKENS
- 类型: 字符串(URL)
- 说明: 钉钉机器人Webhook地址
- 获取方式: 钉钉群机器人设置
- 示例: 'https://oapi.dingtalk.com/robot/send?access_token=...'
- 必需: 可选
- 用途: 消息推送端点

### 掘金配置

#### GM_CLIENT_TOKEN
- 类型: 字符串
- 说明: 掘金量化Token
- 获取方式: 掘金客户端-系统设置-密钥管理
- 示例: 'ad239ba1e307c4e5f31fce19a6c173fb...'
- 必需: 模拟盘必需
- 用途: 模拟盘认证

#### GM_ACCOUNT_ID
- 类型: 字符串(UUID)
- 说明: 掘金仿真账户ID
- 获取方式: 掘金客户端-账户管理-复制账户ID
- 示例: '189ca421-49db-11ef-9fa8-0016...'
- 必需: 模拟盘必需
- 用途: 模拟盘交易

### 远程服务配置

#### RECOMMEND_HOST
- 类型: 字符串(URL)
- 说明: 远程推票服务地址
- 默认: 'http://127.0.0.1:5000'
- 必需: 使用run_remote.py时必需
- 用途: 远程选股服务

#### AUTHENTICATION
- 类型: 字符串
- 说明: 远程服务认证Token
- 默认: '***'
- 必需: 使用远程服务时必需
- 用途: API认证

### 缓存路径配置

#### CACHE_PROD_PATH
- 类型: 字符串
- 说明: 生产环境缓存目录
- 默认: './_cache/prod_pwc'
- 必需: 是
- 用途: 实盘数据存储

#### CACHE_TEST_PATH
- 类型: 字符串
- 说明: 测试环境缓存目录
- 默认: './_cache/test_pwc'
- 必需: 是
- 用途: 模拟盘数据存储

#### TDX_FOLDER
- 类型: 字符串(原始字符串)
- 说明: 通达信安装目录
- 默认: r'C:\new_tdx'
- 必需: 使用mootdx时必需
- 用途: 通达信数据读取

## 股票池配置PoolConf

### 白名单配置

#### white_indexes
- 类型: 列表[字符串]
- 说明: 白名单指数列表
- 默认: [IndexSymbol.INDEX_ZZ_ALL]
- 可选值:
  - INDEX_SH_ZS: 上证指数
  - INDEX_SH_50: 上证50
  - INDEX_HS_300: 沪深300
  - INDEX_ZZ_500: 中证500
  - INDEX_ZZ_1000: 中证1000
  - INDEX_ZZ_ALL: 中证全指
  - INDEX_CY_ZS: 创业板指
  - INDEX_KC_50: 科创50
- 用途: 限制买入标的范围

#### white_industry
- 类型: 列表[字符串]
- 说明: 白名单行业列表
- 示例: ['半导体', '新能源汽车']
- 可选: 是
- 用途: 限定行业板块

#### white_concept
- 类型: 列表[字符串]
- 说明: 白名单概念列表
- 示例: ['人工智能', '量子科技']
- 可选: 是
- 用途: 限定概念题材

### 黑名单配置

#### black_prompts
- 类型: 列表[字符串]
- 说明: 黑名单问财语句
- 默认: ['ST', '退市']
- 示例: ['ST', '*ST', '退市', '停牌']
- 用途: 排除风险股票

#### black_codes
- 类型: 列表[字符串]
- 说明: 黑名单股票代码
- 示例: ['000001.SZ', '600000.SH']
- 可选: 是
- 用途: 手动排除特定股票

## 买入配置BuyConf

### 时间控制

#### time_ranges
- 类型: 列表[列表[字符串,字符串]]
- 说明: 扫描买点时间段
- 默认: [['14:47', '14:57']]
- 格式: [['HH:MM', 'HH:MM'], ...]
- 建议:
  - 尾盘买入: [['14:47', '14:57']]
  - 全天买入: [['09:31', '11:30'], ['13:00', '14:57']]
  - 不买入: []
- 注意: 避免集合竞价时段

#### interval
- 类型: 整数
- 说明: 扫描买入间隔(秒)
- 默认: 30
- 可选值: 1, 2, 3, 4, 5, 6, 10, 12, 15, 20, 30, 60
- 要求: 必须是60的约数
- 建议:
  - 问财选股: ≥30秒(避免封IP)
  - 技术指标: 1-6秒
  - 远程推票: 根据服务性能

### 仓位控制

#### slot_count
- 类型: 整数
- 说明: 持股数量上限
- 默认: 10
- 范围: 1-20
- 建议:
  - 新手: 3-5只
  - 进阶: 5-10只
  - 高频: 10-20只
- 注意: 影响分散程度

#### slot_capacity
- 类型: 浮点数
- 说明: 每个仓位资金上限(元)
- 默认: 10000
- 范围: 1000-50000
- 计算: 单票买入数量 = floor(slot_capacity / price / 100) * 100
- 建议:
  - 10万账户: 5000-10000
  - 50万账户: 20000-50000
  - 100万账户: 50000-100000

#### once_buy_limit
- 类型: 整数
- 说明: 单次选股最多买入数量
- 默认: 10
- 范围: 1-slot_count
- 用途: 限制单次扫描买入过多
- 建议: 等于slot_count即可

### 风险控制

#### order_premium
- 类型: 浮点数
- 说明: 市价单溢价保护(元)
- 默认: 0.02
- 范围: 0.01-0.10
- 用途: 确保市价单成交
- 说明: 委托价 = 现价 + order_premium
- 建议:
  - 低价股(<10元): 0.02-0.05
  - 高价股(>50元): 0.05-0.10

#### inc_limit
- 类型: 浮点数(倍数)
- 说明: 相对昨收盘涨幅限制
- 默认: 1.20
- 范围: 1.00-1.20
- 用途: 避免追高
- 说明: 当日涨幅 = 现价 / 昨收盘
- 建议:
  - 保守: 1.05(涨5%内)
  - 中性: 1.10(涨10%内)
  - 激进: 1.20(涨20%内,接近涨停)

## 卖出配置SellConf

### 时间控制

#### time_ranges
- 类型: 列表[列表[字符串,字符串]]
- 说明: 扫描卖点时间段
- 默认: [['09:31', '11:30'], ['13:00', '14:57']]
- 格式: [['HH:MM', 'HH:MM'], ...]
- 建议: 全天监控
- 注意: 包含午休前后

#### interval
- 类型: 整数
- 说明: 扫描卖出间隔(秒)
- 默认: 1
- 可选值: 1, 2, 3, 4, 5, 6, 10, 12, 15, 20, 30, 60
- 建议:
  - 短线: 1-3秒(及时止损)
  - 中线: 5-15秒
  - 长线: 30-60秒

#### order_premium
- 类型: 浮点数
- 说明: 市价单溢价保护(元)
- 默认: 0.02
- 用途: 卖出时略低于现价确保成交
- 说明: 委托价 = 现价 - order_premium

### 硬性止损HardSeller

#### hard_time_range
- 类型: 列表[字符串,字符串]
- 说明: 硬性止损时间段
- 默认: ['09:31', '14:57']
- 建议: 全天生效
- 用途: 优先级最高的止损

#### earn_limit
- 类型: 浮点数(倍数)
- 说明: 硬性止盈率
- 默认: 9.999
- 范围: 1.05-9.999
- 说明: 当前价 >= 成本价 * earn_limit 时止盈
- 建议:
  - 保守: 1.10(10%止盈)
  - 中性: 1.15(15%止盈)
  - 激进: 9.999(接近不止盈,靠其他策略)

#### risk_limit
- 类型: 浮点数(倍数)
- 说明: 硬性止损率
- 默认: 0.97
- 范围: 0.90-0.99
- 说明: 当前价 <= 成本价 * risk_limit 时止损
- 建议:
  - 保守: 0.98(-2%)
  - 中性: 0.97(-3%)
  - 激进: 0.95(-5%)

#### risk_tight
- 类型: 浮点数
- 说明: 止损线每日上移幅度
- 默认: 0.002
- 范围: 0.000-0.010
- 说明: 止损线 = risk_limit + held_day * risk_tight
- 示例: risk_limit=0.97, risk_tight=0.002
  - 持仓第1天: 97%止损
  - 持仓第2天: 97.2%止损
  - 持仓第3天: 97.4%止损
  - ...
  - 持仓第15天: 100%止损(保本)

### 回落止盈FallSeller

#### fall_time_range
- 类型: 列表[字符串,字符串]
- 说明: 回落止盈时间段
- 默认: ['09:31', '14:57']
- 建议: 全天生效

#### fall_from_top
- 类型: 列表[元组(浮点,浮点,浮点)]
- 说明: 分级回落止盈配置
- 默认: [(1.08, 9.99, 0.02), (1.02, 1.08, 0.05)]
- 格式: [(涨幅下限,涨幅上限,回落幅度), ...]
- 逻辑:
  - 最高价在[成本价*涨幅下限, 成本价*涨幅上限)区间
  - 当前价 < 最高价 * (1-回落幅度)
  - 则卖出
- 示例解读:
  - (1.08, 9.99, 0.02): 涨8%以上,回落2%卖
  - (1.02, 1.08, 0.05): 涨2-8%,回落5%卖
- 建议:
  - 保守: [(1.05, 9.99, 0.03), (1.02, 1.05, 0.08)]
  - 激进: [(1.10, 9.99, 0.02), (1.05, 1.10, 0.03)]

### 回撤止盈ReturnSeller

#### return_time_range
- 类型: 列表[字符串,字符串]
- 说明: 回撤止盈时间段
- 默认: ['09:31', '14:57']
- 建议: 全天生效

#### return_of_profit
- 类型: 列表[元组(浮点,浮点,浮点)]
- 说明: 分级回撤止盈配置
- 默认: [(1.07,9.99,0.20), (1.05,1.07,0.50), (1.03,1.05,0.80)]
- 格式: [(涨幅下限,涨幅上限,利润回撤比), ...]
- 逻辑:
  - 最高价在[成本价*涨幅下限, 成本价*涨幅上限)区间
  - 利润 = 最高价 - 成本价
  - 当前价 < 最高价 - 利润 * 利润回撤比
  - 则卖出
- 示例解读:
  - (1.07,9.99,0.20): 涨7%以上,利润回吐20%卖
  - (1.05,1.07,0.50): 涨5-7%,利润回吐50%卖
  - (1.03,1.05,0.80): 涨3-5%,利润回吐80%卖
- 具体案例:
  - 成本10元,最高价11元(涨10%)
  - 利润=1元
  - 涨10%属于(1.07,9.99)区间
  - 触发价=11-1*0.2=10.8元(回吐0.2元利润)
- 建议:
  - 保守: 利润回撤比设置小(10%-30%)
  - 激进: 利润回撤比设置大(50%-80%)

### 换仓卖出SwitchSeller

#### switch_time_range
- 类型: 列表[字符串,字符串]
- 说明: 换仓卖出时间段
- 默认: ['14:30', '14:57']
- 建议: 尾盘时段
- 用途: 清理弱势票腾仓位

#### switch_hold_days
- 类型: 整数
- 说明: 触发换仓的持仓天数
- 默认: 3
- 范围: 1-10
- 说明: 持仓≥N天未达目标则换仓

#### switch_demand_daily_up
- 类型: 浮点数
- 说明: 日均收益要求
- 默认: 0.003
- 范围: 0.001-0.01
- 说明: 目标价 = 成本价 * (1 + held_day * switch_demand_daily_up)
- 示例: switch_demand_daily_up=0.003
  - 持仓3天目标: 0.9%(3*0.3%)
  - 持仓5天目标: 1.5%(5*0.3%)
  - 持仓10天目标: 3.0%(10*0.3%)

### 均线卖出MASeller

#### ma_time_range
- 类型: 列表[字符串,字符串]
- 说明: 均线卖出时间段
- 默认: ['09:31', '14:57']

#### ma_above
- 类型: 整数
- 说明: 跌破N日均线卖出
- 默认: 5
- 可选: 3, 5, 10, 20, 30, 60
- 建议:
  - 短线: 5日均线
  - 中线: 10日均线
  - 长线: 20日均线

### CCI卖出CCISeller

#### cci_time_range
- 类型: 列表[字符串,字符串]
- 说明: CCI卖出时间段
- 默认: ['09:31', '14:57']

#### cci_upper
- 类型: 浮点数
- 说明: CCI高位卖点阈值
- 默认: 330.0
- 范围: 100-500
- 说明: CCI > cci_upper 超买卖出

#### cci_lower
- 类型: 浮点数
- 说明: CCI低位卖点阈值
- 默认: 10.0
- 范围: -200-0
- 说明: CCI < cci_lower 超卖卖出(止损)

### 开仓日卖出OpenDaySeller

#### opening_time_range
- 类型: 列表[字符串,字符串]
- 说明: 开仓日卖出时间段
- 默认: ['14:40', '14:57']
- 建议: 尾盘时段

#### open_low_rate
- 类型: 浮点数(倍数)
- 说明: 开仓日最低价比例
- 默认: 0.99
- 范围: 0.95-1.00
- 说明: 跌破开仓日最低价*open_low_rate卖出

#### open_vol_rate
- 类型: 浮点数(倍数)
- 说明: 开仓日成交量比例
- 默认: 0.60
- 范围: 0.30-1.00
- 说明: 成交量<开仓日成交量*open_vol_rate卖出

### 次日缩量卖出DropSeller

#### next_time_range
- 类型: 列表[字符串,字符串]
- 说明: 次日缩量判断时间段
- 默认: ['09:31', '14:57']

#### next_volume_dec_minute
- 类型: 字符串(HH:MM)
- 说明: 缩量判断时间点
- 默认: '09:46'
- 建议: 开盘15-30分钟
- 用途: 判断成交量是否萎缩

#### next_volume_dec_threshold
- 类型: 浮点数(倍数)
- 说明: 缩量判断阈值
- 默认: 0.08
- 说明: 当前量<昨日同时段*next_volume_dec_threshold

#### next_volume_dec_limit
- 类型: 浮点数(倍数)
- 说明: 缩量卖出最大涨幅
- 默认: 1.03
- 说明: 涨幅<3%时缩量卖出,涨幅≥3%不卖

## 运行模式配置

### IS_PROD
- 类型: 布尔值
- 说明: 生产环境标志
- 默认: False
- 取值:
  - False: 掘金模拟盘
  - True: QMT实盘交易
- 位置: run_*.py文件
- 重要: ⚠️ 切换实盘前务必确认

### IS_DEBUG
- 类型: 布尔值
- 说明: 调试模式标志
- 默认: True
- 取值:
  - True: 打印debug信息
  - False: 只打印关键信息
- 位置: run_*.py文件
- 用途: 开发调试

## 选股配置

### 问财选股配置

#### select_prompt
- 类型: 字符串
- 说明: 问财选股问句
- 位置: selector/select_wencai.py
- 默认: "中证500成分股,非ST,非科创,MACD金叉,按价格从小到大"
- 示例:
  - "沪深300成分股,涨幅>3%,量比>2"
  - "创业板,市值<50亿,RSI<30"
  - "非ST,MACD金叉,KDJ金叉"
- 限制:
  - 查询频率≥30秒
  - 需要Node.js环境
  - 先在问财网页测试

### 远程推票配置

#### RECOMMEND_HOST
- 类型: 字符串(URL)
- 说明: 推票服务地址
- 位置: credentials.py
- 示例: 'http://192.168.1.100:5000'

#### 推票接口格式
```json
{
  "codes": ["000001.SZ", "600000.SH"],
  "prices": {"000001.SZ": 12.34, "600000.SH": 8.90},
  "reasons": {"000001.SZ": "MACD金叉", "600000.SH": "放量突破"}
}
```

## 消息通知配置

### 钉钉通知级别
- 买入委托: 市买/限买 + 代码名称价格数量
- 卖出委托: 市卖/限卖 + 代码名称价格数量
- 成交回报: 成交 + 代码名称价格数量
- 股票池刷新: 白名单X支 黑名单Y支
- 策略报告: 每日交易汇总
- 异常告警: ⚠️ 错误信息

### 飞书通知配置
- 配置方式类似钉钉
- 位置: tools/utils_feishu.py
- 需要: FEISHU_SECRET, FEISHU_TOKENS

## 参数调优建议

### 新手保守配置
```python
class BuyConf:
    slot_count = 3
    slot_capacity = 5000
    inc_limit = 1.05

class SellConf:
    risk_limit = 0.98          # -2%止损
    earn_limit = 1.10          # 10%止盈
    fall_from_top = [
        (1.05, 9.99, 0.05),   # 涨5%以上,回落5%
    ]
    return_of_profit = [
        (1.03, 9.99, 0.50),   # 涨3%以上,利润回吐50%
    ]
```

### 进阶中性配置
```python
class BuyConf:
    slot_count = 5
    slot_capacity = 10000
    inc_limit = 1.10

class SellConf:
    risk_limit = 0.97
    risk_tight = 0.002
    fall_from_top = [
        (1.08, 9.99, 0.02),
        (1.02, 1.08, 0.05),
    ]
    return_of_profit = [
        (1.07, 9.99, 0.20),
        (1.05, 1.07, 0.50),
        (1.03, 1.05, 0.80),
    ]
```

### 激进策略配置
```python
class BuyConf:
    slot_count = 10
    slot_capacity = 20000
    inc_limit = 1.20

class SellConf:
    risk_limit = 0.95
    risk_tight = 0.001
    fall_from_top = [
        (1.10, 9.99, 0.02),
        (1.05, 1.10, 0.03),
        (1.02, 1.05, 0.08),
    ]
```

## 参数调优流程

### 单一变量法
- 每次只调整一个参数
- 观察至少一周
- 记录调整前后效果
- 确认有效后再调下一个

### 对比测试
- 同时运行两个模拟盘
- 一个作为基准
- 一个测试新参数
- 对比收益和回撤

### 回测验证
- 下载历史数据
- 模拟不同参数组合
- 计算历史收益
- 选择最优参数

### 实盘验证
- 轻仓测试新参数
- 记录每笔交易
- 分析盈亏原因
- 持续优化调整

## 常见参数问题

### 止损过于频繁
- 问题: 经常被小幅波动止损
- 原因: risk_limit设置过高
- 解决: 放宽到0.95(-5%)
- 或者: 增加risk_tight日递增

### 止盈不够及时
- 问题: 盈利后回吐过多
- 原因: fall_from_top回落幅度太大
- 解决: 减小回落幅度(2%-3%)
- 或者: 调整return_of_profit保护利润

### 持仓时间过短
- 问题: 持仓1-2天就卖
- 原因: 换仓策略太激进
- 解决: 增加switch_hold_days到5天
- 或者: 降低switch_demand_daily_up

### 选股数量太少
- 问题: 半天选不出一只票
- 原因:
  - 白名单范围太窄
  - 问财条件太苛刻
  - 黑名单过滤太多
- 解决:
  - 扩大white_indexes
  - 简化选股问句
  - 减少黑名单条件

### 选股数量太多
- 问题: 每次扫描几十只
- 原因:
  - 白名单范围太广
  - 问财条件太宽松
- 解决:
  - 缩小white_indexes
  - 增加技术指标条件
  - 设置once_buy_limit

## 配置文件模板

### credentials.py模板
```python
# QMT实盘
QMT_ACCOUNT_ID = '你的账户ID'
QMT_CLIENT_PATH = r'C:\QMT路径\userdata_mini'

# 钉钉通知(可选)
DING_SECRET = 'SEC...'
DING_TOKENS = 'https://oapi.dingtalk.com/robot/send?access_token=...'

# 掘金模拟盘
GM_CLIENT_TOKEN = 'ad239...'
GM_ACCOUNT_ID = '189ca...'

# 缓存路径
CACHE_PROD_PATH = './_cache/prod_pwc'
CACHE_TEST_PATH = './_cache/test_pwc'
TDX_FOLDER = r'C:\new_tdx'

# 远程服务(可选)
RECOMMEND_HOST = 'http://127.0.0.1:5000'
AUTHENTICATION = '***'
```

### run_wencai_qmt.py配置段
```python
# 运行模式
IS_PROD = False  # False=模拟盘, True=实盘
IS_DEBUG = True  # True=调试模式

# 股票池配置
class PoolConf:
    white_indexes = [IndexSymbol.INDEX_ZZ_500]
    black_prompts = ['ST', '退市']

# 买入配置
class BuyConf:
    time_ranges = [['14:47', '14:57']]
    interval = 30
    order_premium = 0.02
    slot_count = 5
    slot_capacity = 10000
    once_buy_limit = 5
    inc_limit = 1.10

# 卖出配置
class SellConf:
    time_ranges = [['09:31', '11:30'], ['13:00', '14:57']]
    interval = 1
    order_premium = 0.02

    # 硬性止损
    hard_time_range = ['09:31', '14:57']
    earn_limit = 9.999
    risk_limit = 0.97
    risk_tight = 0.002

    # 回落止盈
    fall_time_range = ['09:31', '14:57']
    fall_from_top = [
        (1.08, 9.99, 0.02),
        (1.02, 1.08, 0.05),
    ]

    # 回撤止盈
    return_time_range = ['09:31', '14:57']
    return_of_profit = [
        (1.07, 9.99, 0.20),
        (1.05, 1.07, 0.50),
        (1.03, 1.05, 0.80),
    ]
```

## 总结

### 必需配置
- credentials.py凭证文件
- IS_PROD运行模式
- BuyConf买入参数
- SellConf卖出参数

### 可选配置
- 钉钉飞书通知
- 远程推票服务
- TDX通达信路径
- 自定义选股

### 调优原则
- 从保守开始
- 单一变量法
- 记录调整过程
- 持续优化迭代