# SilverQuant 量化交易框架

## 项目概述

### 核心定位
- A股证券全自动交易框架
- 基于迅投QMT开发
- 开箱即用的量化交易工具
- 面向量化新手友好设计

### 设计理念
- 组件化架构
- 快速策略原型搭建
- 一键切换实盘模拟盘
- 保住本金为第一目标

### 技术栈
- Python 3.10
- 迅投QMT交易接口
- 掘金3模拟盘
- AkShare金融数据
- 同花顺问财AI选股

### 项目特色
- 短线防弹衣式风控
- 多策略组合卖出
- 钉钉飞书消息推送
- 完整交易日志记录

## 核心架构

### 分层设计

#### 委托层(Delegate)
- 交易接口抽象
- 实盘模拟盘统一封装
- 自动重连机制
- 消息推送集成

#### 策略层(Trader)
- 买点扫描逻辑
- 卖点组合策略
- 股票池管理
- 风险控制模块

#### 选股层(Selector)
- 问财AI选股
- 远程推票服务
- 技术指标筛选
- 自定义公式选股

#### 工具层(Tools)
- 数据缓存管理
- 通达信数据接口
- 钉钉飞书通知
- 基础工具函数

### 数据流转
- 行情订阅
- 实时行情缓存更新
- 策略逻辑判断
- 委托下单执行
- 回调记录持仓

## 交易委托模块

### QMT实盘接口(XtDelegate)

#### 连接管理
- 自动建立连接
- 60秒心跳检测
- 断线自动重连
- Session动态生成

#### 订单类型
- 市价买入单
- 市价卖出单
- 限价买入单
- 限价卖出单

#### 账户查询
- 资产查询
- 持仓查询
- 订单查询
- 可撤单查询

#### 订单管理
- 单个订单撤销
- 批量订单撤销
- 买入订单撤销
- 卖出订单撤销

#### 消息推送
- 钉钉消息通知
- 交易实时播报
- 委托状态提醒
- 成交结果推送

### 掘金模拟盘接口(GmDelegate)

#### 账户管理
- 模拟账户登录
- Token认证机制
- 服务器端点配置
- 账户别名设置

#### 数据封装
- 资产数据转换
- 订单数据转换
- 持仓数据转换
- 统一接口标准

#### 交易功能
- 市价委托支持
- 限价委托支持
- 订单状态查询
- 持仓实时更新

### 回调系统

#### 委托回调
- 委托状态变更
- 成交数据记录
- 订单撤销通知
- 异常情况告警

#### 成交回调
- 成交价格记录
- 成交数量统计
- 持仓自动更新
- 交易日志写入

#### 持仓追踪
- 持仓天数计数
- 历史最高价更新
- 历史最低价更新
- 建仓价格保存

## 策略交易模块

### 买入模块(Buyer)

#### 基础买入(BaseBuyer)
- 风险控制开关
- 单票资金上限
- 溢价保护机制
- 涨停限价处理

#### 限量买入(LimitedBuyer)
- 继承基础买入
- 买入比例调节
- 分批建仓支持
- 仓位精确控制

#### 买入流程
- 计算买入数量
- 风控额度检查
- 价格溢价保护
- 涨停价格判断
- 委托下单执行
- 交易记录保存

### 卖出模块(Seller)

#### 基础卖出(BaseSeller)
- 卖出委托封装
- 跌停限价处理
- 溢价保护机制
- 批量持仓扫描

#### 限量卖出(LimitedSeller)
- 分批卖出支持
- 卖出比例设置
- 仓位精确控制
- 保留底仓策略

### 卖出策略组件

#### 硬性卖出(HardSeller)
- 绝对止损卖出
- 绝对止盈卖出
- 止损线日递增
- 时间区间控制

#### 换仓卖出(SwitchSeller)
- 持仓天数要求
- 盈利目标判断
- 日均收益计算
- 尾盘换仓时机

#### 回落卖出(FallSeller)
- 历史最高价追踪
- 分级回落止盈
- 涨幅区间配置
- 回落幅度设置

#### 回撤卖出(ReturnSeller)
- 浮盈回撤计算
- 分级止盈策略
- 利润保护机制
- 回撤比例配置

#### 均线卖出(MASeller)
- 跌破N日均线
- 均线动态计算
- 支撑位判断
- 技术止损配合

#### CCI卖出(CCISeller)
- CCI指标计算
- 冲高卖点判断
- 回落卖点判断
- 超买超卖信号

#### WR卖出(WRSeller)
- WR指标计算
- 上穿阈值卖出
- 超买信号识别
- 技术指标配合

#### 开仓日卖出(OpenDaySeller)
- 破开仓日最低价
- 缩开仓日成交量
- 尾盘时间控制
- 首日止损保护

#### 缩量卖出(DropSeller)
- 次日成交量对比
- 缩量幅度判断
- 时间节点检查
- 涨幅限制设置

#### 上涨阻断器(UppingBlocker)
- 双涨趋势识别
- 日内均价判断
- MACD趋势判断
- 阻断后续卖出

### 策略组合(GroupSeller)

#### 传统组合(ClassicGroupSeller)
- 硬性止损
- 回落止盈
- 回撤止盈
- 基础风控保障

#### 均线组合(ClassicMAGroupSeller)
- 传统组合策略
- 均线技术止损
- 双重保护机制
- 趋势跟踪优化

#### 监控组合(ShieldGroupSeller)
- 硬性止损
- 回落止盈
- 适合半自动交易
- 手动买入量化卖出

#### 问财组合(WencaiGroupSeller)
- 硬性止损
- 回落止盈
- 回撤止盈
- 换仓策略
- 适合问财选股

#### 平台绿缩组合(PTLSGroupSeller)
- 上涨阻断器
- 硬性止损
- 回落止盈
- 回撤止盈
- 换仓策略
- 均线止损
- 六层保护

### 股票池管理(Pools)

#### 白名单类型

##### 指数成分股池
- 中证全指
- 中证500
- 沪深300
- 中证1000
- 创业板指
- 科创50

##### 行业板块池
- 东方财富行业分类
- 板块成分股获取
- 动态更新机制
- 黑名单过滤

##### 概念板块池
- 同花顺概念板块
- 热点题材跟踪
- 概念股筛选
- 主题投资支持

##### 通达信自选池
- 本地TDX安装
- 自选列表读取
- 实时同步更新
- 个人票池管理

##### 前缀代码池
- 按代码前缀筛选
- 主板创业板分离
- 科创板识别
- 北交所支持

#### 黑名单类型

##### 问财黑名单
- 问财语句筛选
- ST股票过滤
- 退市股票排除
- 风险警示股

##### 技术指标预筛
- MACD指标筛选
- 均线位置判断
- 成交量条件
- 技术形态过滤

#### 股票池操作
- 定时刷新机制
- 白名单更新
- 黑名单更新
- 差集计算输出
- 消息通知推送

## 选股模块

### 问财AI选股(Wencai)

#### 核心功能
- 自然语言选股
- Prompt自定义
- 批量查询支持
- 价格数据获取

#### 选股示例
- 中证500成分股
- 非ST非科创
- MACD金叉
- 按价格排序

#### 使用限制
- 需要Node.js环境
- 频率限制30秒
- IP封禁风险
- 每日查询额度

#### 数据字段
- 股票代码
- 股票简称
- 现价元
- 收盘价不复权
- 可扩展字段

### 远程推票服务(Remote)

#### 服务架构
- HTTP接口协议
- Token认证机制
- 推票结果获取
- 自建服务支持

#### 使用场景
- Linux服务器部署
- 分布式计算
- 大数据分析
- 复杂选股模型

#### 接口规范
- 推荐股票列表
- 价格信息
- 买入理由
- 置信度评分

### AI选股模型

#### DeepSeek选股
- AI模型分析
- 多因子评分
- 智能推荐
- 持续优化

#### 自定义公式选股
- 六脉神剑策略
- 龙抬头战法
- 三倍量突破
- 平台绿缩
- 金雀突破

#### 技术指标公式
- MyTT指标库
- 动态参数支持
- 自定义公式
- 回测验证

## 数据接口模块

### 行情数据源

#### XtQuant接口
- QMT官方接口
- 实时行情推送
- 历史数据下载
- 板块数据获取

#### AkShare接口
- 开源金融数据
- 股票基本信息
- 历史行情数据
- 指数成分股
- 免费使用

#### Tushare接口
- 专业金融数据
- Token认证
- 积分限制
- 备用数据源
- 高质量数据

#### MooTdx接口
- 通达信数据
- 本地TDX支持
- 快速数据获取
- 自选列表读取
- 复权数据处理

### 数据缓存系统

#### 文件缓存
- JSON格式
- CSV格式
- Pickle序列化
- 线程锁保护

#### 缓存类型

##### 持仓数据缓存
- held_days.json持仓天数
- max_price.json历史最高价
- min_price.json历史最低价
- 实时更新机制

##### 交易数据缓存
- deal_hist.csv交易历史
- assets.csv资金曲线
- 完整记录保存
- 复盘分析支持

##### 选股数据缓存
- 当日选股记录
- 去重机制
- 历史查询
- 内存缓存优化

##### 行情数据缓存
- 日线历史数据
- Tick实时数据
- DataFrame格式
- 滚动窗口管理

### 技术指标库(MyTT)

#### 内置指标
- MACD指标
- KDJ指标
- RSI指标
- CCI指标
- WR指标
- BOLL指标
- ATR指标
- DMI指标

#### 高级功能
- 动态参数支持
- 自定义周期
- 多时间框架
- 指标组合

#### 增强版本
- MyTT_advance高级版
- MyTT_custom自定义版
- 优化算法性能
- 扩展指标类型

## 策略运行框架

### 订阅调度系统(XtSubscriber)

#### 核心功能
- 行情实时订阅
- 策略定时执行
- 盘前盘后任务
- 交易日识别

#### 调度方式

##### Schedule调度(旧版)
- 简单定时任务
- 轻量级实现
- 基础功能支持
- 向后兼容

##### APScheduler调度(新版)
- 强大定时功能
- Cron表达式
- 任务并发控制
- 高级调度策略

#### 数据管理
- 行情数据聚合
- 实时缓存更新
- 历史数据管理
- Tick数据记录

#### 报告系统
- 每日交易报告
- 持仓汇总报告
- 资金变动报告
- 消息推送通知

### 策略执行流程

#### 盘前准备
- 交易日判断
- 持仓天数递增
- 股票池刷新
- 订阅列表更新
- 系统状态检查

#### 盘中执行

##### 买点扫描
- 时间区间判断
- 扫描间隔控制
- 选股逻辑执行
- 买入条件判断
- 委托下单

##### 卖点扫描
- 时间区间判断
- 扫描间隔控制
- 持仓逐个检查
- 卖出策略判断
- 委托下单

#### 盘后处理
- 交易日报生成
- 持仓统计汇总
- 资金曲线记录
- 数据持久化
- 消息推送

### 配置参数系统

#### 股票池配置(PoolConf)
- white_indexes白名单指数
- black_prompts黑名单问句
- 指数列表
- 筛选条件

#### 买入配置(BuyConf)
- time_ranges扫描时间段
- interval扫描间隔秒
- order_premium溢价元
- slot_count持仓上限
- slot_capacity单仓资金
- once_buy_limit单次买入数
- inc_limit涨幅限制

#### 卖出配置(SellConf)
- time_ranges扫描时间段
- interval扫描间隔秒
- order_premium溢价元
- hard_time_range硬止损时段
- earn_limit止盈率
- risk_limit止损率
- risk_tight止损日递增
- 各卖出策略参数

## 启动入口程序

### run_wencai_qmt.py

#### 功能定位
- 问财AI选股
- QMT实盘交易
- 掘金模拟盘测试
- 适合快速原型

#### 策略特点
- 自定义选股Prompt
- ClassicGroupSeller卖出
- 完整风控保护
- 适合新手学习

#### 使用场景
- 模拟盘策略测试
- 参数优化调试
- 月度收益预估
- 实盘策略验证

### run_wencai_tdx.py

#### 功能定位
- 问财选股
- 通达信数据源
- 脱离QMT运行
- 独立模拟盘

#### 技术特点
- TDX本地数据
- 模拟盘回测
- 轻量级部署
- 快速验证

### run_remote.py

#### 功能定位
- 远程推票服务
- HTTP接口获取
- 分布式场景
- 高级策略支持

#### 适用场景
- Linux服务器
- 大数据计算
- 复杂选股模型
- 团队协作

#### 技术要求
- 自建推票服务
- HTTP服务器
- Token认证
- 数据接口规范

### run_shield.py

#### 功能定位
- 半自动交易
- 手动买入
- 量化卖出
- 主观量化结合

#### 策略特点
- ShieldGroupSeller
- 简化卖出策略
- 保留主观判断
- 降低策略风险

#### 使用场景
- 主观选股
- 自动止损
- 趋势跟踪
- 新手过渡

### run_swords.py

#### 功能定位
- 打板策略模板
- 涨停板监控
- 封板条件判断
- 激进策略

#### 风险提示
- 高风险策略
- 需要优化
- 谨慎实盘
- 充分回测

### run_ai_gen.py

#### 功能定位
- 公式选股样板
- 技术指标筛选
- 学习参考
- 策略模板

#### 使用说明
- 仅供学习
- 勿用实盘
- 需要改进
- 回测优化

## 消息通知系统

### 钉钉机器人(Ding)

#### 配置步骤
- 创建钉钉群
- 添加自定义机器人
- 获取加签密钥
- 获取Webhook地址
- 填入credentials.py

#### 消息类型
- 文本消息
- Markdown消息
- 交易播报
- 异常告警

#### 通知内容
- 买入委托
- 卖出委托
- 成交回报
- 策略状态
- 系统异常

### 飞书机器人(Feishu)

#### 配置方式
- 创建飞书群
- 添加机器人
- 获取Webhook
- 配置密钥

#### 功能支持
- 富文本消息
- 卡片消息
- 交易通知
- 报表推送

## 风险控制系统

### 仓位控制

#### 总仓位限制
- 持仓数量上限
- 单仓资金上限
- 可用资金检查
- 仓位动态调整

#### 单票风控
- 建仓金额限制
- 持仓比例控制
- 加仓次数限制
- 禁止重复建仓

### 止损止盈

#### 硬性止损
- 绝对止损线
- 日递增止损
- 强制止损
- 保本优先

#### 硬性止盈
- 绝对止盈线
- 固定收益目标
- 快速止盈
- 落袋为安

#### 动态止盈
- 历史最高价追踪
- 回落比例止盈
- 分级止盈
- 利润保护

#### 回撤止盈
- 浮盈回撤计算
- 分级回撤
- 利润回吐控制
- 心理压力管理

### 选股风控

#### 白名单过滤
- 指数成分股限制
- 流动性要求
- 市值范围
- 板块限制

#### 黑名单排除
- ST股票
- 退市风险股
- 停牌股票
- 低流动性股

#### 技术指标过滤
- 均线位置
- 成交量要求
- 技术形态
- 动量指标

### 交易风控

#### 涨停保护
- 涨停价格判断
- 自动切换限价单
- 避免追高
- 成交率保证

#### 跌停保护
- 跌停价格判断
- 限价单处理
- 流动性保护
- 滑点控制

#### 时间控制
- 尾盘不买入
- 集合竞价避免
- 午间休市
- 非交易时段

## 日志监控系统

### 交易日志

#### 委托记录
- 委托时间
- 股票代码
- 委托价格
- 委托数量
- 委托方向
- 策略备注

#### 成交记录
- 成交时间
- 成交价格
- 成交数量
- 成交金额
- 手续费
- 盈亏计算

#### 持仓记录
- 持仓代码
- 持仓数量
- 可用数量
- 成本价
- 当前价
- 浮动盈亏
- 持仓天数

### 资金曲线

#### 记录内容
- 总资产
- 可用资金
- 冻结资金
- 持仓市值
- 当日盈亏
- 累计盈亏

#### 绩效分析
- 收益率计算
- 最大回撤
- 夏普比率
- 胜率统计
- 盈亏比

### 策略日志

#### 运行日志
- 启动时间
- 策略名称
- 配置参数
- 运行状态
- 错误信息

#### 调试日志
- Debug信息
- 变量状态
- 执行流程
- 性能指标

## 部署运维

### 环境要求

#### 操作系统
- Windows系统
- Windows 10以上
- 64位系统
- 稳定网络

#### Python环境
- Python 3.10.11推荐
- Pip包管理器
- 虚拟环境支持
- IDE工具PyCharm

#### 必需软件
- QMT交易客户端
- Node.js v16+
- 掘金3客户端(模拟盘)
- WinRAR解压工具

### 安装配置

#### Python依赖
- pip install -r requirements.txt
- 镜像源加速
- 依赖版本锁定
- 虚拟环境隔离

#### QMT配置
- 券商开通权限
- 下载对应版本
- 极简模式启动
- 数据源连接

#### 凭证配置
- 复制credentials_sample.py
- 重命名为credentials.py
- 填写QMT账户信息
- 配置通知密钥

#### 缓存目录
- 创建_cache目录
- prod_pwc生产缓存
- test_pwc测试缓存
- 权限设置

### 运行维护

#### 启动检查
- QMT客户端运行
- 数据源连接正常
- 网络连接稳定
- 系统资源充足

#### 盘中监控
- 日志实时查看
- 委托状态确认
- 持仓变化跟踪
- 异常及时处理

#### 盘后处理
- 查看交易记录
- 统计当日盈亏
- 分析交易质量
- 优化策略参数

#### 定期维护
- 更新依赖包
- 清理缓存文件
- 备份配置文件
- 日志归档

## 开发扩展

### 自定义选股策略

#### 问财选股
- 修改select_wencai.py
- 自定义Prompt
- 测试选股结果
- 验证数据字段

#### 技术指标选股
- 使用MyTT指标库
- 编写筛选公式
- 历史数据回测
- 优化参数

#### 远程选股
- 搭建HTTP服务
- 定义接口规范
- 实现推票逻辑
- 部署上线

### 自定义卖出策略

#### 创建新Seller
- 继承BaseSeller
- 实现check_sell方法
- 定义策略参数
- 编写卖出逻辑

#### 组合策略
- 编辑seller_groups.py
- 创建新GroupSeller
- 多策略继承
- 调整执行顺序

#### 测试验证
- 模拟盘测试
- 参数调优
- 回测验证
- 实盘观察

### 数据接口扩展

#### 新增数据源
- 继承BaseDelegate
- 实现接口方法
- 数据格式转换
- 异常处理

#### 自定义指标
- 编写MyTT公式
- 测试指标效果
- 参数优化
- 集成到策略

## 最佳实践

### 策略开发流程
- 明确策略思路
- 问财验证可行性
- 编写策略代码
- 模拟盘测试1个月
- 参数优化调整
- 轻仓实盘验证
- 逐步放大仓位

### 风险管理原则
- 先轻仓模拟
- 设置严格止损
- 分散持仓
- 控制回撤
- 及时止盈
- 定期复盘

### 参数调优建议
- 从保守参数开始
- 单一变量法
- 记录每次调整
- 观察效果至少一周
- 避免过度优化
- 保持策略简单

### 实盘注意事项
- 盘前检查系统
- 留足现金缓冲
- 避免满仓操作
- 关注市场环境
- 控制交易频率
- 遵守交易纪律

## 故障排查

### 常见问题

#### QMT连接失败
- 检查客户端是否运行
- 确认数据源连接
- 检查userdata_mini路径
- 重启QMT客户端
- 查看系统日志

#### 问财选股报错
- 确认Node.js已安装
- 检查网络连接
- 降低查询频率
- 更新pywencai版本
- 测试问句有效性

#### 依赖包问题
- 更新akshare版本
- 安装缺失依赖
- 检查Python版本
- 清理pip缓存
- 重建虚拟环境

#### 数据缓存异常
- 检查缓存目录权限
- 清理损坏文件
- 重建缓存数据
- 检查磁盘空间
- 验证JSON格式

### 日志分析
- 查看logs.txt
- 定位错误信息
- 分析堆栈跟踪
- 查找相关代码
- 针对性修复

## 附录

### 系统依赖清单
- numpy==2.2.6
- pandas==2.3.2
- APScheduler>=3.11.0
- akshare>=1.17.44
- mootdx>=0.11.7
- pywencai>=0.12.3
- requests>=2.31.0
- schedule>=1.2.1
- tushare>=1.4.24

### 目录结构
- /delegate交易委托层
- /trader策略交易层
- /selector选股模块
- /tools工具函数
- /mytt技术指标库
- /public用户策略
- /tests测试用例
- /_cache数据缓存

### 配置文件说明
- credentials.py凭证配置
- requirements.txt依赖清单
- .gitignore忽略列表
- README.md项目说明

### 参考资源
- QMT官方文档
- AkShare文档
- 问财平台
- 掘金量化平台
- MyTT指标库
- GitHub Issues

### 免责声明
- 财不入急门
- 先轻仓模拟
- 策略需验证成熟
- 作者不承担损失
- 注意合规使用
- 风险自担